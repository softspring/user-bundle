{% trans_default_domain 'sfs_user' %}
{% extends '@SfsUser/admin_layout.html.twig' %}

{% block breadcrums_content %}
    {{ parent() }}
    <li class="breadcrumb-item"><a href="{{ url('sfs_user_admin_users_list') }}">Users</a></li>
    <li class="breadcrumb-item active" aria-current="page">{{ sfs_user_is('nameSurname') ? user.name~' '~user.surname : user.username }}</li>
{% endblock breadcrums_content %}

{% block content %}
    <div class="container-fluid">
        <div class="row">
            <div class="col">
                <h1 class="h3 mb-4">User details</h1>
            </div>

            <div class="col text-end">
                {% if is_granted('ROLE_ADMIN_USERS_UPDATE', user) %}
                    <a href="{{ url('sfs_user_admin_users_update', {'user': user}) }}" class="btn btn-outline-secondary">Edit</a>
                {% endif %}

                {% if switch_enabled and is_granted(switch_role) %}
                    <a href="{{ url(switch_route, switch_route_params) }}{{ switch_route_params|length ? '&' : '?' }}{{ switch_parameter }}={{ user.username }}"
                       class="btn btn-outline-secondary"><i class="bi bi-incognito"></i> view as {{ user.username }}</a>
                {% endif %}

                <div class="btn-group dropdown">
                    <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="dropdownMoreActions" data-bs-toggle="dropdown" aria-expanded="false">
                        More
                    </button>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMoreActions">
                        {% if is_granted('ROLE_ADMIN_USERS_PROMOTE', user) %}
                            <a href="{{ url('sfs_user_admin_users_promote_admin', {'user':user}) }}" class="dropdown-item">Promote Admin</a>
                        {% endif %}

                        <a href="#" class="dropdown-item disabled">Reset password</a>
                        <a href="#" class="dropdown-item disabled">Manual password</a>

                        {% if is_granted('ROLE_ADMIN_USERS_DELETE', user) %}
                            <a href="{{ url('sfs_user_admin_users_delete', {'user':user}) }}" class="dropdown-item">Delete</a>
                        {% endif %}

                        {% if sfs_user_is('confirmable') %}
                            {% if user.confirmed %}
                                <a href="#" class="dropdown-item disabled">Unconfirm</a>
                            {% else %}
                                <a href="#" class="dropdown-item disabled">Confirm</a>
                                <a href="{{ url('sfs_user_admin_users_resend', {'user':user}) }}" class="dropdown-item">Resend confirmation</a>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="row">
            <div class="col-4">
                <div class="bg-white p-4">
                    <div class="text-center mb-4">
                        {% if sfs_user_is('avatar') %}
                            <img alt="{{ user.username }}" src="{{ user.avatarUrl }}" width="128" height="128" class="rounded-circle mb-3">
                        {% endif %}

                        {% if sfs_user_is('nameSurname') %}
                            <h4>{{ user.name }} {{ user.surname }}</h4>
                        {% endif %}
                    </div>

                    {% if sfs_user_is('identifierUsername') %}
                        <p><strong>username:</strong><br/>{{ user.username }}</p>
                    {% endif %}

                    {% if sfs_user_is('identifierEmail') or sfs_user_is('email') %}
                        <p><strong>email:</strong><br/>{{ user.email }}</p>
                    {% endif %}

                    {% if sfs_user_is('confirmable') %}
                        <p>
                            <strong>confirmed:</strong><br/>                            {% if user.confirmed %}
                                <span class="bi bi-check  align-middle text-success"></span>
                                at
                                <span title="{{ user.confirmedAt|date('H:i:s d-m-Y', 'UTC') }} UTC">{{ user.confirmedAt|date('H:i:s d-m-Y', 'Europe/Madrid') }}</span>
                            {% else %}
                                <span class="bi bi-x align-middle text-danger"></span>
                            {% endif %}
                        </p>
                    {% endif %}

                    {% if sfs_user_is('lastLogin') %}
                        <p><strong>lastLogin:</strong><br/>
                            {% if user.lastLogin %}
                                <span title="{{ user.lastLogin|date('H:i:s d-m-Y', 'UTC') }} UTC">{{ user.lastLogin|date('H:i:s d-m-Y', 'Europe/Madrid') }}</span>
                            {% else %}
                                not yet
                            {% endif %}
                        </p>
                    {% endif %}

                    <p><strong>role:</strong><br/>{{ user.roles|join(', ') }}</p>

                    {% if sfs_user_is('hasLocalePreference') %}
                        <p><strong>locale:</strong><br/>{{ user.locale|default('not selected') }}</p>
                    {% endif %}
                </div>
            </div>

            <div class="col">
                {% if is_granted('ROLE_ADMIN_ACCESS_HISTORY_LIST') and user_access_history is defined %}
                    {% include '@SfsUser/admin/components/_user_access_history_card.html.twig' %}
                {% endif %}
            </div>
        </div>
    </div>

{#        {% if multi_accounted_user %}#}
{#            <div class="card">#}
{#                <div class="card-header">#}
{#                    <h4>Accounts</h4>#}
{#                </div>#}
{#                <div class="card-body">#}
{#                    {% if user.relations.count %}#}
{#                    <ul>#}
{#                        {% for relation in user.relations %}#}
{#                            <li>#}
{#                                {% if route_defined('sfs_account_admin_accounts_details') %}#}
{#                                    <a href="{{ url('sfs_account_admin_accounts_details', {'account':relation.account}) }}">{{ relation.account.name }}</a>#}
{#                                {% else %}#}
{#                                    {{ relation.account.name }}#}
{#                                {% endif %}#}

{#                                {% if relation.grantedBy is defined and relation.grantedBy != relation.user %}#}
{#                                    (granted by {{ relation.grantedBy.username }})#}
{#                                {% endif %}#}
{#                            </li>#}
{#                        {% endfor %}#}
{#                    </ul>#}
{#                    {% else %}#}
{#                        <p><em>This user is not associated to any account</em></p>#}
{#                    {% endif %}#}
{#                </div>#}
{#            </div>#}
{#        {% endif %}#}

{#        {% if false %}#}
{#        <div class="col">#}
{#            <div class="card">#}
{#                <div class="card-header">#}
{#                    <h4>Emails sent</h4>#}
{#                </div>#}
{#                <div class="card-body">#}
{#                    <p><i>TODO</i></p>#}
{#                </div>#}
{#            </div>#}
{#        </div>#}
{#        {% endif %}#}
{% endblock content %}